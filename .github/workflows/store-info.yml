name: Update Store Info
on:
    push:
        branches:
            - '**'
        paths:
            - 'docs/store.md'
            - 'docs/store.en.md'
            - 'docs/manual.md'
            - 'docs/manual.en.md'
            - '.shopware-extension.yml'
    workflow_dispatch:
jobs:
    update-store-info:
        if: github.ref_name == vars.LATEST_BRANCH && vars.PUBLISH_SHOPWARE_STORE == 'true'
        runs-on: ubuntu-latest
        steps:
            - name: Checkout code
              uses: actions/checkout@v4
            - name: Install shopware-cli
              uses: shopware/shopware-cli-action@v1
            - name: Build
              shell: bash
              run: shopware-cli account producer extension info push .
              env:
                  SHOPWARE_CLI_ACCOUNT_EMAIL: ${{ secrets.ACCOUNT_USER }}
                  SHOPWARE_CLI_ACCOUNT_PASSWORD: ${{ secrets.ACCOUNT_PASSWORD }}

    update-moori-plugin-store-info:
        if: github.ref_name == vars.LATEST_BRANCH
        uses: moorl/github-actions/.github/workflows/moori-plugin-store-info.yml@main
        secrets:
            MOORI_PLUGIN_STORE_URL: ${{ secrets.MOORI_PLUGIN_STORE_URL }}
            MOORI_PLUGIN_STORE_API_ID: ${{ secrets.MOORI_PLUGIN_STORE_API_ID }}
            MOORI_PLUGIN_STORE_API_SECRET: ${{ secrets.MOORI_PLUGIN_STORE_API_SECRET }}
